<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Escribir Nueva Reseña</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="reseñaForm" (ngSubmit)="guardar()">
        
        <!-- Autor -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Autor</mat-label>
          <mat-select formControlName="autor" required>
            <mat-option *ngFor="let usuario of usuarios" [value]="usuario">
              {{usuario.nombre}} {{usuario.apellido}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="reseñaForm.get('autor')?.hasError('required')">
            Seleccione el autor
          </mat-error>
        </mat-form-field>

        <!-- Receptor -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Receptor</mat-label>
          <mat-select formControlName="receptor" required>
            <mat-option *ngFor="let usuario of usuarios" [value]="usuario">
              {{usuario.nombre}} {{usuario.apellido}}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="reseñaForm.get('receptor')?.hasError('required')">
            Seleccione el receptor
          </mat-error>
        </mat-form-field>

        <!-- Puntaje -->
        <div class="rating-container">
          <label>Calificación *</label>
          <mat-button-toggle-group formControlName="puntaje" class="rating-group">
            <mat-button-toggle *ngFor="let num of puntajes" [value]="num">
              <span class="stars">
                <mat-icon *ngFor="let star of [].constructor(num)">star</mat-icon>
                <mat-icon *ngFor="let star of [].constructor(5-num)">star_border</mat-icon>
              </span>
            </mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error *ngIf="reseñaForm.get('puntaje')?.hasError('required')">
            Seleccione una calificación
          </mat-error>
        </div>

        <!-- Comentario -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Comentario</mat-label>
          <textarea matInput formControlName="comentario" rows="5" 
                    maxlength="500" required
                    placeholder="Escriba su comentario aquí..."></textarea>
          <mat-hint align="end">
            {{reseñaForm.get('comentario')?.value?.length || 0}}/500
          </mat-hint>
          <mat-error *ngIf="reseñaForm.get('comentario')?.hasError('required')">
            El comentario es obligatorio
          </mat-error>
        </mat-form-field>

        <!-- Botones -->
        <div class="button-row">
          <button mat-raised-button color="primary" type="submit" 
                  [disabled]="reseñaForm.invalid">
            <mat-icon>rate_review</mat-icon>
            Publicar Reseña
          </button>
          <button mat-raised-button type="button" (click)="cancelar()">
            <mat-icon>cancel</mat-icon>
            Cancelar
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>