<div class="container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>Buscar Tickets de Soporte</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      <form [formGroup]="searchForm" (ngSubmit)="buscar()">
        <div class="search-controls">
          
          <!-- Criterio de bÃºsqueda -->
          <mat-form-field appearance="outline">
            <mat-label>Buscar por</mat-label>
            <mat-select formControlName="criterio">
              <mat-option value="estado">Estado</mat-option>
              <mat-option value="usuario">Usuario</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Campo Estado -->
          <mat-form-field appearance="outline" class="flex-grow" 
                          *ngIf="searchForm.value.criterio === 'estado'">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="valorEstado">
              <mat-option value="Pendiente">Pendiente</mat-option>
              <mat-option value="En Proceso">En Proceso</mat-option>
              <mat-option value="Resuelto">Resuelto</mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Campo Usuario -->
          <mat-form-field appearance="outline" class="flex-grow" 
                          *ngIf="searchForm.value.criterio === 'usuario'">
            <mat-label>Usuario</mat-label>
            <mat-select formControlName="valorUsuario">
              <mat-option *ngFor="let usuario of usuarios" [value]="usuario">
                {{usuario.nombre}} {{usuario.apellido}}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Botones -->
          <button mat-raised-button color="primary" type="submit">
            <mat-icon>search</mat-icon>
            Buscar
          </button>
          
          <button mat-raised-button type="button" (click)="limpiar()">
            <mat-icon>clear</mat-icon>
            Limpiar
          </button>
        </div>
      </form>

      <!-- Resultados -->
      <div *ngIf="resultadosVisibles" class="results-container">
        <h3>Resultados ({{tickets.length}})</h3>
        
        <div *ngIf="tickets.length === 0" class="no-results">
          <mat-icon>info</mat-icon>
          <p>No se encontraron resultados</p>
        </div>

        <mat-accordion *ngIf="tickets.length > 0">
          <mat-expansion-panel *ngFor="let ticket of tickets">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-chip [color]="ticket.estado === 'Resuelto' ? 'primary' : 
                                   ticket.estado === 'Pendiente' ? 'warn' : 'accent'">
                  {{ticket.estado}}
                </mat-chip>
                <span class="ticket-id">Ticket #{{ticket.idSoporte}}</span>
              </mat-panel-title>
              <mat-panel-description>
                {{ticket.usuario.nombre}} {{ticket.usuario.apellido}} - 
                {{ticket.fecha | date:'dd/MM/yyyy HH:mm'}}
              </mat-panel-description>
            </mat-expansion-panel-header>
            
            <div class="ticket-details">
              <div class="detail-row">
                <strong>Usuario:</strong> 
                {{ticket.usuario.nombre}} {{ticket.usuario.apellido}}
              </div>
              <div class="detail-row">
                <strong>Email:</strong> 
                {{ticket.usuario.email}}
              </div>
              <div class="detail-row">
                <strong>Fecha:</strong> 
                {{ticket.fecha | date:'dd/MM/yyyy HH:mm:ss'}}
              </div>
              <div class="detail-row message">
                <strong>Mensaje:</strong>
                <p>{{ticket.mensaje}}</p>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
    </mat-card-content>
  </mat-card>
</div>